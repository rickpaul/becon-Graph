<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
	<script src="/lib/queue/queue.min.js"></script>
</head>
<body>
	

	<script type="text/javascript">
		var t;
		function nodes_loaded_callback(error, results) {
			console.log('nodes_loaded_callback');
			var nodes_ = {};
			results.forEach(function(d){
				nodes_[d.node_id] = d;
			})
			console.log(nodes_);
		}

		function get_node_info(node_id, callback) {
			setTimeout(function(){
				t = new Date().getTime();
				console.log('fn(get_node_info'+node_id+') ' + ' subtask starting ('+t+')');
				callback(null, {node_id: node_id, value: node_id*2});
			},Math.random()*1000);
		}

		function get_all_nodes_info() {
			[1,2,3,4].forEach(function(d){
				queue()
					.defer(get_node_info, d);
			})
		}

		get_all_nodes_info();
	</script>	









	<script type="text/javascript">
		// var outer = {}
		// var t;
		// function b(num, object){
		// 	t = new Date().getTime();
		// 	console.log('fn(b'+num+') ' + ' starting ('+t+')');
			// setTimeout(function(){
			// 	t = new Date().getTime();
			// 	console.log('fn(b'+num+') ' + ' subtask starting ('+t+')');
			// 	object[num] = num*2;
			// 	outer[num] = num*2;
			// },Math.random()*1000);
		// 	t = new Date().getTime();
		// 	console.log('fn(b'+num+') finished ('+t+')');
		// };

		// function a(callback){
		// 	t = new Date().getTime();
		// 	console.log('fn(a) starting ('+t+')');
		// 	setTimeout(function(){
		// 		t = new Date().getTime();
		// 		console.log('fn(a) sending 4 subrequests ('+t+')');
		// 		var object = [1,2,3,4];
		// 		var x = {};
		// 		object.map(function(d){
		// 			b(d, x);
		// 		});
		// 		callback(x);
		// 	}, 500); // wait 500 ms
		// 	t = new Date().getTime();
		// 	console.log('fn(a) finished ('+t+')');
		// };

		// function callback(d) {
		// 	console.log(d);
		// };

		// a(callback);


	</script>	
</body>
</html>